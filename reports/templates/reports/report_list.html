<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רשימת דיווחים עם מפה</title>
    <link href="https://fonts.googleapis.com/css2?family=David:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.5.0/css/bootstrap.min.css">
    <style>
        /* General page styles */
body {
    font-family: 'David', sans-serif;
    background-color: #f9f9f9;
    padding: 20px;
    direction: rtl;
}

/* Header */
h1 {
    font-size: 24px;
    color: #2c3e50;
    margin-bottom: 20px;
    text-align: center;
}

/* Add Report Button */
.add-report-btn {
    display: inline-block;
    background-color: #3498db;
    color: #fff;
    padding: 10px 20px;
    font-size: 14px;
    border-radius: 5px;
    text-decoration: none;
    margin-bottom: 20px;
}

.add-report-btn:hover {
    background-color: #2980b9;
}

/* Report item list */
.report-item {
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
}

.report-item h5 {
    font-size: 18px;
    color: #34495e;
}

.report-item p {
    font-size: 14px;
    color: #7f8c8d;
    margin: 5px 0;
}

.location {
    font-weight: bold;
}

/* Map container */
#map {
    width: 100%;
    height: 600px;  /* Increase the height */
    margin-top: 20px;
    border-radius: 8px;
}


/* Pagination styles */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 30px;
}

.pagination .page-item {
    margin: 0 10px;
}

.pagination .page-link {
    text-decoration: none;
    color: #3498db;
    font-size: 16px;
    padding: 8px 12px;
    border-radius: 5px;
    border: 1px solid #3498db;
}

.pagination .page-link:hover {
    background-color: #3498db;
    color: white;
}

.pagination .current-page {
    font-size: 16px;
    font-weight: bold;
    color: #34495e;
    margin: 0 10px;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>רשימת דיווחים</h1>

        <!-- Add Report Button -->
        <a href="{% url 'add_report' %}" class="add-report-btn">הוסף דיווח חדש</a>

        <!-- Loop through reports and display them -->
        {% for report in reports_data %}
        <div class="report-item">
            <h5>{{ report.title }}</h5>
            <p>תיאור הדיווח: {{ report.description }}</p>
            <p class="location">מיקום: {{ report.location }}</p>
            <!-- Convert the type to Hebrew -->
        <p class="location">סוג דיווח: {{ report.type_name }}</p>
      </div>
        {% endfor %}

        <!-- Map -->
        <div class="form-group">
            <label for="map" class="form-label">מפה של כל הדיווחים</label>
            <div id="map"></div>
        </div>

        <!-- Pagination controls -->
        <div class="pagination">
            <span class="page-item disabled">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            <div class="pagination-links">
                {% if page_obj.has_previous %}
                    <a href="?page=1" class="page-link">First</a>
                    <a href="?page={{ page_obj.previous_page_number }}" class="page-link">Previous</a>
                {% endif %}
                <span class="current-page">{{ page_obj.number }}</span>
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="page-link">Next</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}" class="page-link">Last</a>
                {% endif %}
            </div>
        </div>
    </div>
<script>
    // Initialize the map
    function initMap() {
        var beershevaCoords = { lat: 31.2518, lng: 34.7913 }; // Coordinates of Be'er Sheva

        var map = new google.maps.Map(document.getElementById('map'), {
            center: beershevaCoords,
            zoom: 12
        });

        // Loop through reports_data and create map markers
        {% for report in reports_data %}
        var marker = new google.maps.Marker({
            position: { lat: {{ report.latitude|default:0 }}, lng: {{ report.longitude|default:0 }} },
            map: map,
            title: '{{ report.title }}',
            icon: {
                path: google.maps.SymbolPath.CIRCLE,  // Shape of the marker (circle)
                scale: 12,  // Increase the size to make it larger
                fillColor: '#ff6347',  // Customize color (you can change this)
                fillOpacity: 1,
                strokeWeight: 2  // Thickness of the border
            }
        });

        // Create a new InfoWindow for each marker inside the loop
        var infoWindow = new google.maps.InfoWindow({
            content: `<h6>{{ report.title }}</h6><p>סוג דיווח: {{ report.get_type_display }}</p>`
        });

        // Attach the InfoWindow to the marker
        marker.addListener('click', function() {
            infoWindow.open(map, marker);
        });
        {% endfor %}
    }

    // Load the Google Maps API with the correct callback
    function loadMapScript() {
        var script = document.createElement('script');
        script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyDlCLAutdnujjoTEDdpYwIUvOSTluY2rRQ&callback=initMap";
        document.body.appendChild(script);
    }

    // Wait until the page is ready to load the script
    window.onload = loadMapScript;
</script>


</body>
</html>
